<div class="function_line">
<span class="server" title="Server">&#160;</span>NPC&#58;GetEnemy( <span class="function_args"></span> ) </div><div class="gmodwiki_useful_links"><a rel="nofollow" class="external text" href="https://github.com/Facepunch/garrysmod/search?utf8=âœ“&amp;q=NPC.GetEnemy">Search on GitHub</a> - <a href="/page/Special:WhatLinksHere/NPC/GetEnemy" title="Special:WhatLinksHere/NPC/GetEnemy">What links here?</a></div>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#Description"><span class="tocnumber">1</span> <span class="toctext">Description</span></a></li>
<li class="toclevel-1"><a href="#Returns"><span class="tocnumber">2</span> <span class="toctext">Returns</span></a></li>
<li class="toclevel-1"><a href="#Examples"><span class="tocnumber">3</span> <span class="toctext">Examples</span></a>
<ul>
<li class="toclevel-2"><a href="#Example"><span class="tocnumber">3.1</span> <span class="toctext">Example</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Examples_2"><span class="tocnumber">4</span> <span class="toctext">Examples</span></a>
<ul>
<li class="toclevel-2"><a href="#Example_2"><span class="tocnumber">4.1</span> <span class="toctext">Example</span></a></li>
</ul>
</li>
</ul>
</td></tr></table>
<h1> <span class="mw-headline" id="Description">Description</span></h1>
<p>Returns the entity that this NPC is trying to fight.
</p>
<table class="gmodwiki_note bug_note">
<tr>
<td>BUG
</td>
<td>
<p>This returns nil if the NPC has no enemy. You should use <a href="/page/Global/IsValid" title="Global/IsValid">IsValid</a> (which accounts for nil and NULL) on the return to verify validity of the enemy.
</p><p><b>Issue Tracker: <a rel="nofollow" class="external text" href="https://github.com/Facepunch/garrysmod-issues/issues/3132">#3132</a></b>
</p>
</td></tr></table>
<h1 class="first_ret"> <span class="mw-headline" id="Returns">Returns</span></h1>
<div class="return" style="counter-increment: returns;">
<p><span class="ret_number" style="counter-increment: returns -1;"></span> <span class="ret_chunk"><a href="/page/Category_colon_NPC" title="Category:NPC">NPC</a></span>
</p>
<div style="margin-left: 32px;">
Enemy NPC.</div>
</div>
<h1 class="first_example"> <span class="mw-headline" id="Examples">Examples</span></h1>
<h2 class="examples_number"> <span class="mw-headline" id="Example">Example</span></h2>
<p>Kill any npc that sets the first player as its enemy.
</p>
<pre><code data-language="lua">local function Think( )
	for k, v in pairs( ents.GetAll( ) ) do
		if v:IsNPC( ) and v:GetEnemy( ) == Entity( 1 ) then
			v:TakeDamage( 999 )
		end
	end
end

hook.Add( &quot;Think&quot;, &quot;Kill My Enemies&quot;, Think )</code></pre>
<p><b>Output:</b>
</p>
<div style="margin:2em;">Any npc that sets their enemy to Entity( 1 ) dies.</div>
<h1 class="first_example"> <span class="mw-headline" id="Examples_2">Examples</span></h1>
<h2 class="examples_number"> <span class="mw-headline" id="Example_2">Example</span></h2>
<p>Make every NPC that does not have an enemy (and preferably a <a rel="nofollow" class="external text" href="/page/Enums/D">D_HT</a> relationship agains Players) start attacking a random Player. This code is copied from the gamemode <a rel="nofollow" class="external text" href="https://steamcommunity.com/sharedfiles/filedetails/?id=1647345157">My Base Defence</a>:
</p>
<pre><code data-language="lua">-- ...
local function _SetRandomPlayerTargetForNPC(npc)
	if (npc:IsNPC()) then
		if (!IsValid(npc:GetEnemy())) then
			local _allPlayers	= player.GetAll()
			local _winnerPlNr	= math.random(1, #_allPlayers)

			timer.Simple(0.15, function()
				local __Player = _allPlayers[_winnerPlNr]
				--
				--- Set the enemy for the NPC, so it does not just stand there doing nothing
				-- lika young lazy teen or something
				if (!npc:IsValid() or&#160;!__Player:IsValid()) then return end
				npc:SetEnemy(__Player)
				npc:UpdateEnemyMemory(__Player, __Player:GetPos())
				npc:SetSchedule(SCHED_SHOOT_ENEMY_COVER)
			end)
		end
	end
end
-- - - ---
-- --
-- Make every NPC that might not have a target, recive one random Player..:&gt;&gt;
-- (..you can place this loop inside an interval timer or something...)
for _, v in pairs(ents.GetAll('npc_*')) do
	if v:IsValid() then _SetRandomPlayerTargetForNPC(v) end
end</code></pre>
<p><b>Output:</b>
</p>
<div style="margin:2em;">All NPCs on the SERVER will get their memory updated if they don't already have an enemy, and start moving to the last know position of the enemy and try to attack. This enemy will be a random Player. They will also try and shoot enemy cover.</div>


