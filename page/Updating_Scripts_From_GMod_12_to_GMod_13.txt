<h1> <span class="mw-headline" id=".E2.80.9CWhy_your_scripts_are_now_broken.E2.80.9D"> “Why your scripts are now broken” </span></h1>
<p>Several changes to the Lua API were made in the transition between GMod 12 to GMod 13. This page is an attempt to highlight them. It was originally created in the form of a Google Document created by Garry.
The old method of doing things is listed on the left, while the new is on the right side.
</p>
<h1> <span class="mw-headline" id="Changes"> Changes </span></h1>
<ul><li> <b>The <a href="/page/Category_colon_PANEL_Hooks" title="Category:PANEL Hooks">PANEL</a>:<a href="/page/PANEL/Paint" title="PANEL/Paint">Paint</a> hook now receives a width and height parameter.</b> This shouldn't affect much in itself - but if you're calling a derma.SkinHook you will need to pass the width and height along, as it needs these values too now. You could start doing this now in your code without any negative effects.
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td>
<pre><code data-language="lua">function PANEL:Paint()
	derma.SkinHook( &quot;Paint&quot;, &quot;Frame&quot;, self )
	return true
end</code></pre>
</td>
<td>
<pre><code data-language="lua">function PANEL:Paint( w, h )
	derma.SkinHook( &quot;Paint&quot;, &quot;Frame&quot;, self, w, h )
	return true
end</code></pre>
</td></tr></table>
<ul><li> <b><a href="/page/Category_colon_Entity" title="Category:Entity">Entity</a>:<a href="/page/Entity/SetColor" title="Entity/SetColor">SetColor</a> and <a href="/page/Category_colon_Entity" title="Category:Entity">Entity</a>:<a href="/page/Entity/GetColor" title="Entity/GetColor">GetColor</a> now deal with <a href="/page/Structures/Color" title="Structures/Color">Color structures</a> only.</b> Not with single variables. This is something that is always mentioned - and since we're breaking stuff anyway now seems to be a good time to make the change. SetColor will set the color to purple if the passed variable isn't a Color.
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td>
<pre><code data-language="lua">Entity:SetColor( r, g, b, a )
local r, g, b, a = Entity:GetColor()</code></pre>
</td>
<td>
<pre><code data-language="lua">Entity:SetColor( Color( r, g, b, a ) )
local c = Entity:GetColor()
local r,g,b,a = c.r, c.g, c.b, c.a</code></pre>
</td></tr></table>
<ul><li> <b>KeyValuesToTable and TableToKeyValues are now in the util library.</b>
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td>
<pre><code data-language="lua">KeyValuesToTable( blah )
TableToKeyValues( blah )</code></pre>
</td>
<td>
<pre><code data-language="lua">util.KeyValuesToTable( blah )
util.TableToKeyValues( blah )</code></pre>
</td></tr></table>
<ul><li> <b>SetMaterialOverride, cam.StartMaterialOverride (which did the same thing) are removed and replaced with <a href="/page/Category_colon_render" title="Category:render">render</a>.<a href="/page/render/MaterialOverride" title="render/MaterialOverride">MaterialOverride</a>.</b>
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td>
<pre><code data-language="lua">cam.StartMaterialOverride( blah )
SetMaterialOverride( blah )</code></pre>
</td>
<td>
<pre><code data-language="lua">render.MaterialOverride( blah )</code></pre>
</td></tr></table>
<ul><li> <b>IMaterial:SetMaterialTexture is now <a href="/page/Category_colon_IMaterial" title="Category:IMaterial">IMaterial</a>:<a href="/page/IMaterial/SetTexture" title="IMaterial/SetTexture">SetTexture</a></b>
</li></ul>
<ul><li> <b>DMultiChoice is replaced by <a href="/page/Category_colon_DComboBox" title="Category:DComboBox">DComboBox</a>.</b> When I originally made them they were named the wrong way around. DMultiChoice is now removed. This is because <a href="/page/Category_colon_DListView" title="Category:DListView">DListView</a> was basically recreating all the functionality of DMultiChoice. DListView has extra settings to remove colums and headers - which make it exactly like the old DComboBox. Complicated eh?
</li></ul>
<table cellspacing="0" class="gmodwiki_note">
<tr>
<td>NOTE
</td>
<td>
<p>SetEditable(boolean) doesn't exist on DComboBox
</p>
</td></tr></table>
<ul><li> <b>DSysButton was removed.</b> This panel used the Marlett font to create icons such as the "close" button for windows. This isn't needed anymore since we're using GWEN skins. Plus it didn't work properly on Mac anyway.
</li></ul>
<ul><li> <b>Datastream module is removed.</b> Datastream was less than optimal when it came to networking stuff. We now have the new <a href="/page/Category_colon_net" title="Category:net">net library</a> - which doesn't work in exactly the same way, but is much more optimized to do this stuff. You should use the net library instead of datastream.
</li></ul>
<ul><li> <b>DBevel is removed.</b> This panel was purely decorational - so it shouldn't be hard for you to replace.
</li></ul>
<ul><li> <b>utilx no longer exists.</b> Please replace all ocurances of utilx in your code to the <a href="/page/Category_colon_util" title="Category:util">util library</a>.
</li></ul>
<ul><li> <b>entity.Classname. Caps is now enforced properly.</b> Use entity.ClassName instead. (N is upper case)
</li></ul>
<ul><li> <b>TOOL:RenderToolScreen is now <a href="/page/Category_colon_TOOL_Hooks" title="Category:TOOL Hooks">TOOL</a>:<a href="/page/TOOL/DrawToolScreen" title="TOOL/DrawToolScreen">DrawToolScreen</a></b>
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td>
<pre><code data-language="lua">function TOOL:RenderToolScreen()
	cam.Start2D()
	...
	cam.End2D()
end</code></pre>
</td>
<td>
<pre><code data-language="lua">function TOOL:DrawToolScreen( w, h )
	cam.Start2D()
	...
	cam.End2D()
end</code></pre>
</td></tr></table>
<ul><li> <b><a href="/page/Category_colon_file" title="Category:file">file</a>.<a href="/page/file/Find" title="file/Find">Find</a> now returns two tables - files and folders.</b> The second argument is the search path.
<ul><li> "LUA" searches the lua files (in /lua/, in your gamemodes, in all the addons). This replaces file.FindInLua.
</li><li> "GAME" searches all the mounted content (main folder, addons, mounted games etc).
</li><li> "MOD" searches only the garrysmod folder.
</li><li> "DATA" searches in the data folder.
</li></ul>
</li></ul>
<p>Type "path" in the console to see the paths.
</p>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td><pre><code data-language="lua">file.FindInLua(&quot;entities/*.lua&quot;)</code></pre>
</td>
<td><pre><code data-language="lua">file.Find(&quot;entities/*.lua&quot;,&quot;LUA&quot;)</code></pre>
</td></tr>
<tr>
<td><pre><code data-language="lua">file.Find(&quot;models/model.mdl&quot;)</code></pre>
</td>
<td><pre><code data-language="lua">file.Find(&quot;models/model.mdl&quot;, &quot;GAME&quot;)</code></pre>
</td></tr>
<tr>
<td><pre><code data-language="lua">file.FindDir(&quot;exampledir&quot;)</code></pre>
</td>
<td><pre><code data-language="lua">file.Find(&quot;example&quot;, &quot;DATA&quot;)</code></pre> (2nd return)
</td></tr>
<tr>
<td><pre><code data-language="lua">file.Read(&quot;settings/users.txt&quot;, true)</code></pre>
</td>
<td><pre><code data-language="lua">file.Read(&quot;settings/users.txt&quot;, &quot;GAME&quot;)</code></pre>
</td></tr>
<tr>
<td><pre><code data-language="lua">file.Read(&quot;example.txt&quot;)</code></pre>
</td>
<td><pre><code data-language="lua">file.Read(&quot;example.txt&quot;, &quot;DATA&quot;)</code></pre>
</td></tr>
<tr>
<td><pre><code data-language="lua">file.Exists(&quot;example.txt&quot;)</code></pre>
</td>
<td><pre><code data-language="lua">file.Exists(&quot;example.txt&quot;, &quot;DATA&quot;)</code></pre>
</td></tr>
<tr>
<td><pre><code data-language="lua">file.Exists(&quot;models/models.mdl&quot;, true)</code></pre>
</td>
<td><pre><code data-language="lua">file.Exists(&quot;models/models.mdl&quot;, &quot;GAME&quot;)</code></pre>
</td></tr></table>
<ul><li> <b>file.ReadString removed, use <a href="/page/Category_colon_file" title="Category:file">file</a>.<a href="/page/file/Read" title="file/Read">Read</a></b>
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td><pre><code data-language="lua">file.ReadString( ... )</code></pre>
</td>
<td><pre><code data-language="lua">file.Read( ... )</code></pre>
</td></tr></table>
<ul><li> <b><a href="/page/Category_colon_DColorMixer" title="Category:DColorMixer">DColorMixer</a>.RGBBar is now DColorMixer.RGB.</b> GMod 13 uses Grocel's DColorMixer.
</li></ul>
<ul><li> <b>STool language phrases changed.</b>
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td><pre><code data-language="lua">languge.Add(&quot;Tool_toolname_name&quot;, &quot;Text&quot;)</code></pre>
</td>
<td><pre><code data-language="lua">languge.Add(&quot;tool.toolname.name&quot;, &quot;Text&quot;)</code></pre>
</td></tr></table>
<ul><li> <b>The <a href="/page/Category_colon_http" title="Category:http">http library</a> has changed</b>
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td><pre><code data-language="lua">http.Get( url, headers, callback, ... )</code></pre>
</td>
<td><pre><code data-language="lua">http.Fetch( url, onsuccess, onfailure )
http.Post( url, params, onsuccess, onfailure )</code></pre>
</td></tr></table>
<ul><li> <b><a href="/page/Category_colon_timer" title="Category:timer">timer library</a> calls no longer take <a href="/page/Category_colon_vararg" title="Category:vararg">varargs</a> to pass to callback.</b>
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td><pre><code data-language="lua">timer.Simple( 10, MyFunc, &quot;hello&quot;, 10, 10 )</code></pre>
</td>
<td><pre><code data-language="lua">timer.Simple( 10, function() MyFunc( &quot;hello&quot;, 10, 10) end )</code></pre>
<p>or
</p>
<pre><code data-language="lua">local func = function()
	MyFunc( &quot;hello&quot;, 10, 10)
end

timer.Simple( 10, func )</code></pre>
</td></tr></table>
<ul><li> <b>Angle functions have been unified.</b> Before some were Set/GetAngles and some were Set/GetAngle. Now they're all Set/GetAngles()
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td>
<pre><code data-language="lua">blahblah:SetAngle()
blahblah:GetAngle()</code></pre>
</td>
<td>
<pre><code data-language="lua">blahblah:SetAngles()
blahblah:GetAngles()</code></pre>
</td></tr></table>
<ul><li> <b>timer.IsTimer is now <a href="/page/Category_colon_timer" title="Category:timer">timer</a>.<a href="/page/timer/Exists" title="timer/Exists">Exists</a>.</b> Sounds better, yeah.
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td><pre><code data-language="lua">timer.IsTimer(&quot;derp&quot;)</code></pre>
</td>
<td><pre><code data-language="lua">timer.Exists(&quot;derp&quot;)</code></pre>
</td></tr></table>
<ul><li> <b><a href="/page/Category_colon_math" title="Category:math">math library</a> duplicate functions removed</b> (Deg2Rad, Rad2Deg)
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td>
<pre><code data-language="lua">math.Rad2Deg(1)
math.Deg2Rad(1)</code></pre>
</td>
<td>
<pre><code data-language="lua">math.deg(1)
math.rad(1)</code></pre>
</td></tr></table>
<ul><li> <b>server_settings module removed, use cvars instead.</b>
</li></ul>
<ul><li> <b>Renamed Material:[Get|Set]Material* to Material:[Get|Set]*</b> (ie,&#160;:SetVector instead of&#160;:SetMaterialVector)
</li></ul>
<ul><li> <b>Moved some functions into the <a href="/page/Category_colon_game" title="Category:game">game library</a>.</b>
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td><pre><code data-language="lua">GetWorldEntity()</code></pre>
</td>
<td><pre><code data-language="lua">game.GetWorld()</code></pre>
</td></tr>
<tr>
<td><pre><code data-language="lua">isDedicatedServer()</code></pre>
</td>
<td><pre><code data-language="lua">game.IsDedicated()</code></pre>
</td></tr>
<tr>
<td><pre><code data-language="lua">SinglePlayer()</code></pre>
</td>
<td><pre><code data-language="lua">game.SinglePlayer()</code></pre>
</td></tr>
<tr>
<td><pre><code data-language="lua">MaxPlayers()</code></pre>
</td>
<td><pre><code data-language="lua">game.MaxPlayers()</code></pre>
</td></tr></table>
<ul><li> <b>WorldSound has been replaced with <a href="/page/Category_colon_sound" title="Category:sound">sound</a>.<a href="/page/sound/Play" title="sound/Play">Play</a>.</b>
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td><pre><code data-language="lua">WorldSound( &quot;zinger/items/darthit.mp3&quot;, tr.HitPos, 80, 120 )</code></pre>
</td>
<td><pre><code data-language="lua">sound.Play( &quot;zinger/items/darthit.mp3&quot;, tr.HitPos, 80, 120 )</code></pre>
</td></tr></table>
<ul><li> <b>Player:GetCursorAimVector is now <a href="/page/Category_colon_Player" title="Category:Player">Player</a>:<a href="/page/Player/GetAimVector" title="Player/GetAimVector">GetAimVector</a>.</b>
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td><pre><code data-language="lua">Player:GetCursorAimVector()</code></pre>
</td>
<td><pre><code data-language="lua">Player:GetAimVector()</code></pre>
</td></tr></table>
<ul><li> <b>Entity Colour Alpha Changes.</b> In previous version of GMod setting the Alpha of an entity would also change its render mode. In 13 this behaviour was stopped - as it interfered with other things (like entities showing as invisible in some maps). This means that in 13 you need to change the render mode too - if you want your entity to show as transparent.
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td><pre><code data-language="lua">ent:SetColor( 255, 255, 255, 100 )</code></pre>
</td>
<td><pre><code data-language="lua">ent:SetColor( Color( 255, 255, 255, 100 ) )
ent:SetRenderMode( RENDERMODE_TRANSALPHA )</code></pre>
</td></tr></table>
<ul><li> <b><a href="/page/Category_colon_GM_Hooks" title="Category:GM Hooks">GM</a>:<a href="/page/GM/EntityTakeDamage" title="GM/EntityTakeDamage">EntityTakeDamage</a> has been changed.</b> The arguments <pre><code data-language="lua">attacker, inflictor, amount</code></pre> have been removed as they're available by querying the passed damageinfo.
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td><pre><code data-language="lua">GM:EntityTakeDamage( ent, attacker, inflictor, amount, damageinfo )</code></pre>
</td>
<td><pre><code data-language="lua">GM:EntityTakeDamage( ent, dmginfo )</code></pre>
<p>and
</p>
<pre><code data-language="lua">local attacker = dmginfo:GetAttacker()
local inflictor = dmginfo:GetInflictor()
local amount = dmginfo:GetDamage()</code></pre>
</td></tr></table>
<ul><li> <b>The bitwise operators have been removed.</b> I know the old way was nicer - but we took a vote - sorry!
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td><pre><code data-language="lua">local a = CONTENTS_SOLID | CONTENTS_MOVEABLE</code></pre>
</td>
<td><pre><code data-language="lua">local a = bit.bor( CONTENTS_SOLID, CONTENTS_MOVEABLE )</code></pre>
</td></tr></table>
<ul><li> <b>ValidEntity has been removed. Use <a href="/page/Global/IsValid" title="Global/IsValid">IsValid</a> instead.</b>
</li></ul>
<table class="wikitable">
<tr>
<th>Old
</th>
<th>New
</th></tr>
<tr>
<td><pre><code data-language="lua">if ( ValidEntity( ent ) ) then</code></pre>
</td>
<td><pre><code data-language="lua">if ( IsValid( ent ) ) then</code></pre>
</td></tr></table>


